#!/usr/bin/env ruby
#
# Copyright (C) 2014 Droonga Project
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License version 2.1 as published by the Free Software Foundation.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA

require "optparse"
require "sys/proctable"

require "droonga/command/droonga_engine"
require "droonga/service_installation"

service_installation = Droonga::ServiceInstallation.new
service_installation.ensure_using_service_base_directory

running = system("droonga-engine-status", *ARGV)
exit(false) unless running

configuration = Droonga::Command::DroongaEngine::Configuration.new
parser = OptionParser.new
configuration.add_command_line_options(parser)
parser.parse!(ARGV)

pid_file = configuration.pid_file_path
pid = File.read(pid_file).strip
puts "Sending SIGTERM to the process...";
Process.kill(:TERM, pid.to_i)
exit(true)
